import pytest
from rest_framework import status

from common.serializers.person import (
    EmployeeHyperlinkedDetailSerializer,
    EmployeeRetrieveSerializer,
)

from .utils.mixins import TestUtilsMixin


@pytest.mark.django_db
class TestEmployees(TestUtilsMixin):
    base_url_name = "employee"

    def test_anon_retrieve(self, employee, anon_client):
        response = anon_client.get(self.detail_url(employee.id))

        assert response.status_code == self.not_auth_response.status_code
        assert response.data == self.not_auth_response.data

    def test_auth_retrieve(self, employee, auth_client):
        response = auth_client.get(self.detail_url(employee.id))

        assert response.status_code == status.HTTP_200_OK
        assert response.data == EmployeeRetrieveSerializer(employee).data

    def test_admin_retrieve(self, employee, admin_client):
        response = admin_client.get(self.detail_url(employee.id))

        assert response.status_code == status.HTTP_200_OK
        assert response.data == EmployeeRetrieveSerializer(employee).data

    def test_anon_list(self, employees, anon_client):
        response = anon_client.get(self.list_url())

        assert response.status_code == self.not_auth_response.status_code
        assert response.data == self.not_auth_response.data

    def test_auth_list(self, employees, auth_client):
        response = auth_client.get(self.list_url())
        context = {"request": self.list_request()}

        assert response.status_code == status.HTTP_200_OK
        assert (
            response.data
            == EmployeeHyperlinkedDetailSerializer(
                employees, context=context, many=True
            ).data
        )

    def test_admin_list(self, employees, admin_client):
        response = admin_client.get(self.list_url())
        context = {"request": self.list_request()}

        assert response.status_code == status.HTTP_200_OK
        assert (
            response.data
            == EmployeeHyperlinkedDetailSerializer(
                employees, context=context, many=True
            ).data
        )

    def test_create(self):
        pass

    def test_update(self):
        pass

    def test_partial_update(self):
        pass

    def test_destroy(self):
        pass
