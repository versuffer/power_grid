from django.core.exceptions import ValidationError

import pytest
from testing.mock_data.valid_data import valid_workday_data
from testing.utils.mixins import TestUtilsMixin

from timesheets.workdays.models import WorkDay


@pytest.mark.django_db
class TestWorkdaysConstraints(TestUtilsMixin):
    model_class = WorkDay
    base_url_name = "workday"

    def test_constraint_unique_workday(self, workday_saved, auth_client):
        data = {
            "date": workday_saved.date,
            "employee": workday_saved.employee,
        }
        data.update(valid_workday_data)

        with pytest.raises(ValidationError) as exc_info:
            self.model_class.objects.create(**data)

        assert "уже существует" in str(exc_info)
