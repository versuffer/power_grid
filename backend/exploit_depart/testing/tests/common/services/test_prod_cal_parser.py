from datetime import date, datetime

from common.data.timesheets import choices
from common.services.prod_cal_parser import (
    get_default_calendar_dict,
    get_prod_calendar_dict,
)


class TestProdCalParser:
    def test_get_default_calendar_dict(self):
        possible_lengths_set = {365, 366}
        possible_values_set = {
            choices.workday_verbose,
            choices.weekend_verbose,
            choices.shortened_verbose,
        }

        cal_dict = get_default_calendar_dict(year=datetime.now().year)
        value_check_set = set(cal_dict.values())

        try:
            dates_list = map(date.fromisoformat, cal_dict.keys())
        except ValueError:
            assert False, "Wrong date string format ('2023-01-01' format is needed)."

        assert len(cal_dict) in possible_lengths_set
        assert value_check_set.issubset(possible_values_set)

    def test_get_prod_calendar_dict(self):
        possible_lengths_set = {365, 366}
        possible_values_set = {
            choices.workday_verbose,
            choices.weekend_verbose,
            choices.shortened_verbose,
        }

        cal_dict = get_prod_calendar_dict()
        value_check_set = set(cal_dict.values())

        try:
            dates_list = map(date.fromisoformat, cal_dict.keys())
        except ValueError:
            assert False, "Wrong date string format ('2023-01-01' format is needed)."

        assert len(cal_dict) in possible_lengths_set
        assert value_check_set.issubset(possible_values_set)
