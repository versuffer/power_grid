from datetime import date, datetime

import pytest
from mixer.backend.django import mixer
from rest_framework.renderers import JSONRenderer
from testing.data.valid_data import valid_timesheet_data

from common.services.utils import generate_random_string
from timesheets.models import TimeSheet


@pytest.fixture
def timesheet(employee):
    timesheet_obj = TimeSheet(
        timesheet_name=generate_random_string(str_len=50),
        period_start=date(year=datetime.now().year, month=1, day=1),
        period_end=date(year=datetime.now().year, month=1, day=15),
    )
    timesheet_obj.save()
    timesheet_obj.employees.add(employee)
    timesheet_obj.save()
    return timesheet_obj


@pytest.fixture
def timesheet_json(employee):
    valid_data = valid_timesheet_data.copy()
    valid_data["employees"].append(employee.id)
    return JSONRenderer().render(data=valid_data)


@pytest.fixture
def timesheets(employee):
    return mixer.cycle(2).blend(TimeSheet, employees=[employee.id])
