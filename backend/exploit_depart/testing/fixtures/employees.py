from copy import deepcopy

import pytest
from mixer.backend.django import mixer
from rest_framework.renderers import JSONRenderer
from testing.data.valid_data import valid_employee_data

from employees.models import Employee


@pytest.fixture
def employee(user, right):
    employee = mixer.blend(Employee)
    employee.supervisors.add(user)
    employee.rights.add(right)
    return employee


@pytest.fixture
def employee_json(user, right):
    valid_data = deepcopy(valid_employee_data)
    valid_data["supervisors"].append(user.id),
    valid_data["rights"].append(right.id),
    return JSONRenderer().render(data=valid_data)


@pytest.fixture
def employee_factory(user_factory, right_factory):
    def factory():
        employee = mixer.blend(Employee)
        employee.supervisors.add(user_factory())
        employee.rights.add(right_factory())
        return employee

    return factory


@pytest.fixture
def employees(user, right):
    return mixer.cycle(2).blend(Employee, supervisors=[user.id], rights=[right.id])
