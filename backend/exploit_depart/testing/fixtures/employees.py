import pytest
from mixer.backend.django import mixer
from rest_framework.renderers import JSONRenderer

from employees.models import Employee


@pytest.fixture
def employee(user, right):
    employee = mixer.blend(Employee)
    employee.supervisors.add(user)
    employee.rights.add(right)
    return employee


@pytest.fixture
def employee_json(user, right):
    data = {
        "supervisors": [user.id],
        "rights": [right.id],
        "first_name": "Комолов",
        "last_name": "Станислав",
        "middle_name": "Дмитриевич",
        "individual_number": 3960,
        "department": "РОКЛ",
        "unit": None,
        "position": "Инж.",
        "grade": None,
        "personnel_type": "Админ/тех",
        "elec_safety_grade": "IV",
        "voltage_level_grade": "До и выше 1000 В",
        "last_exam_date": "2023-04-19",
        "suit_size_height_summer": "170-176",
        "suit_size_height_winter": "170-176",
        "suit_size_width_summer": "96–100",
        "suit_size_width_winter": "96–100",
        "footwear_size_summer": "42",
        "footwear_size_winter": "42",
    }

    return JSONRenderer().render(data=data)


@pytest.fixture
def employee_factory(user_factory, right_factory):
    def factory():
        employee = mixer.blend(Employee)
        employee.supervisors.add(user_factory())
        employee.rights.add(right_factory())
        return employee

    return factory


@pytest.fixture
def employees(user, right):
    return mixer.cycle(2).blend(Employee, supervisors=[user.id], rights=[right.id])
