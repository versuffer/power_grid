import pytest
from django.contrib.auth import get_user_model

from mixer.backend.django import mixer
from rest_framework.test import APIClient
from rest_framework_simplejwt.tokens import RefreshToken

User = get_user_model()


def create_tokens(user: User):
    token = RefreshToken.for_user(user)
    return {"refresh_token": str(token), "access_token": str(token.access_token)}


def authenticate(client: APIClient, access_token: str):
    client.credentials(HTTP_AUTHORIZATION="JWT " + access_token)
    return client


@pytest.fixture
def user():
    return mixer.blend(User)


@pytest.fixture
def user_tokens(user):
    return create_tokens(user)


@pytest.fixture
def anon_client():
    return APIClient


@pytest.fixture
def auth_client(user_tokens):
    return authenticate(APIClient, user_tokens.get("access_token"))
