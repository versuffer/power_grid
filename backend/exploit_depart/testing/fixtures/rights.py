import pytest
from mixer.backend.django import mixer
from rest_framework.renderers import JSONRenderer
from testing.data.valid_data import valid_right_data

from employees.rights.models import Right


@pytest.fixture
def right():
    right = mixer.blend(
        Right,
        category="Э/Б",
        voltage_level_grade="До и выше 1000 В",
    )
    return right


@pytest.fixture
def right_json():
    return JSONRenderer().render(data=valid_right_data)


@pytest.fixture
def right_factory(employee):
    def factory():
        right = mixer.blend(
            Right,
            category="Э/Б",
            voltage_level_grade="До и выше 1000 В",
        )
        right.owners.add(employee)
        return right

    return factory


@pytest.fixture
def rights(employee):
    new_rights = mixer.cycle(2).blend(
        Right,
        category="Э/Б",
        voltage_level_grade="До и выше 1000 В",
    )
    for right in new_rights:
        right.owners.add(employee.id)

    return Right.objects.prefetch_related("owners").all()
