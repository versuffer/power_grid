from datetime import time, timedelta

from timesheet.choices import DAY_STATUS
from timesheet.models import WorkDay

from .prod_cal_parser import get_prod_calendar_dict


def create_raw_calendar(employee):
    prod_cal_dict = get_prod_calendar_dict()
    work_day_list = []

    for date, day_status in prod_cal_dict.items():
        if day_status == "Рабочий день":
            work_day = WorkDay(
                date=date,
                employee=employee,
                day_status=DAY_STATUS[0][0],
                work_started=time(8, 0, 0),
                work_ended=time(17, 0, 0),
                launch_started=time(12, 0, 0),
                launch_ended=time(13, 0, 0),
                work_duration=timedelta(hours=8),
                launch_duration=timedelta(hours=1),
            )

        if day_status == "Выходной":
            work_day = WorkDay(
                date=date,
                employee=employee,
                day_status=DAY_STATUS[1][0],
                work_started=None,
                work_ended=None,
                launch_started=None,
                launch_ended=None,
                work_duration=None,
                launch_duration=None,
            )

        if day_status == "Сокращённый день":
            work_day = WorkDay(
                date=date,
                employee=employee,
                day_status=DAY_STATUS[2][0],
                work_started=time(8, 0, 0),
                work_ended=time(16, 0, 0),
                launch_started=time(12, 0, 0),
                launch_ended=time(13, 0, 0),
                work_duration=timedelta(hours=7),
                launch_duration=timedelta(hours=1),
            )

        work_day_list.append(work_day)

    WorkDay.objects.bulk_create(objs=work_day_list, ignore_conflicts=True)
