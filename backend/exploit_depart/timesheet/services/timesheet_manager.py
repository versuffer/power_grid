from datetime import time, timedelta

from django.apps import apps
from timesheet.choices import DAY_STATUS

from .prod_cal_parser import get_prod_calendar_dict


def create_raw_calendar(employee):
    prod_cal_dict = get_prod_calendar_dict()
    workday_list = []
    workday_model = apps.get_model("timesheet", "WorkDay")

    for date, day_status in prod_cal_dict.items():
        if day_status == "Рабочий день":
            work_day = workday_model(
                date=date,
                employee=employee,
                day_status=DAY_STATUS[0][0],
                work_started=time(8, 0, 0),
                work_ended=time(17, 0, 0),
                launch_started=time(12, 0, 0),
                launch_ended=time(13, 0, 0),
                work_duration=timedelta(hours=8),
                launch_duration=timedelta(hours=1),
            )

        if day_status == "Выходной":
            work_day = workday_model(
                date=date,
                employee=employee,
                day_status=DAY_STATUS[1][0],
                work_started=None,
                work_ended=None,
                launch_started=None,
                launch_ended=None,
                work_duration=None,
                launch_duration=None,
            )

        if day_status == "Сокращённый день":
            work_day = workday_model(
                date=date,
                employee=employee,
                day_status=DAY_STATUS[2][0],
                work_started=time(8, 0, 0),
                work_ended=time(16, 0, 0),
                launch_started=time(12, 0, 0),
                launch_ended=time(13, 0, 0),
                work_duration=timedelta(hours=7),
                launch_duration=timedelta(hours=1),
            )

        workday_list.append(work_day)

    workday_model.objects.bulk_create(objs=workday_list, ignore_conflicts=True)
