from rest_framework import serializers

from employees.serializers import EmployeeHyperlinkedDetailSerializer

from .models import TimeSheet
from .workdays.serializers import WorkDayHyperlinkedDetailSerializer

from .services.validation import TimeSheetValidator


class TimeSheetDefaultSerializer(serializers.ModelSerializer):
    class Meta:
        model = TimeSheet
        fields = "__all__"
        read_only_fields = ["workdays"]

    def validate(self, data):
        validator = TimeSheetValidator(self, data)
        return validator.timesheet_object_validation()


class TimeSheetListSerializer(serializers.ModelSerializer):
    employees = EmployeeHyperlinkedDetailSerializer(many=True)

    class Meta:
        model = TimeSheet
        exclude = ["workdays"]


class TimeSheetRetrieveSerializer(
    serializers.HyperlinkedModelSerializer, TimeSheetDefaultSerializer
):
    employees = EmployeeHyperlinkedDetailSerializer(many=True)
    workdays = WorkDayHyperlinkedDetailSerializer(many=True)


class TimeSheetCreateSerializer(TimeSheetDefaultSerializer):
    def create(self, validated_data):
        instance = super().create(validated_data)
        instance.save()
        return instance


class TimeSheetUpdateSerializer(TimeSheetDefaultSerializer):
    def update(self, instance, validated_data):
        instance = super().update(instance, validated_data)
        instance.save()
        return instance
